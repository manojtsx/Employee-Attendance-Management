# Employee Attendance System

A comprehensive web-based attendance management system built with Next.js, featuring role-based access control, geolocation verification, auto-checkout functionality, and support for both English and Nepali date formats.

## üöÄ Features

- **Role-Based Access Control**: Separate interfaces for Admin and Employee users
- **Geolocation Verification**: Employees must be within office premises to check in/out
- **Auto-Checkout**: Automatic checkout on browser close or inactivity
- **Dual Calendar Support**: English (Gregorian) and Nepali (Bikram Sambat) calendars
- **Real-time Monitoring**: Live attendance tracking and dashboard updates
- **Comprehensive Reporting**: Detailed attendance records and analytics

## üìã Table of Contents

- [Quick Start](#quick-start)
- [User Roles](#user-roles)
- [Admin Guide](#admin-guide)
- [Employee Guide](#employee-guide)
- [System Workflow](#system-workflow)
- [Configuration](#configuration)
- [API Reference](#api-reference)
- [Troubleshooting](#troubleshooting)

## üöÄ Quick Start

### Prerequisites
- Node.js 18+ and npm
- PostgreSQL database
- Environment variables configured

### Installation
```bash
# Clone the repository
git clone <repository-url>
cd employee-attendance-system

# Install dependencies
npm install

# Set up environment variables
cp .env.example .env
# Edit .env with your configuration

# Set up database
npx prisma migrate dev
npx prisma db seed

# Start development server
npm run dev
```

### Environment Variables
```bash
# Database
DATABASE_URL="postgresql://username:password@localhost:5432/attendance_db"

# NextAuth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key"

# Admin Registration
ADMIN_REGISTRATION_CODE="ADMIN123"

# Auto-checkout
CRON_API_KEY="your-cron-api-key"
```

## üë• User Roles

### üîê Admin
- **Full System Access**: Manage all aspects of the attendance system
- **Employee Management**: Add, view, and remove employees
- **System Configuration**: Set office location, manage settings
- **Reporting & Analytics**: View comprehensive attendance reports
- **User Administration**: Manage user accounts and permissions

### üë§ Employee
- **Attendance Tracking**: Check in and check out daily
- **Personal Dashboard**: View own attendance history and statistics
- **Profile Management**: Update personal information
- **Real-time Status**: See current check-in status and working hours

---

## üõ†Ô∏è Admin Guide

### Initial Setup

#### 1. **Admin Registration**
- Navigate to `/register` or `/admin/register`
- Fill in admin details:
  - Full Name
  - Email Address
  - Secure Password
  - Admin Registration Code (default: `ADMIN123`)
- Click "Register" to create admin account

#### 2. **Office Location Setup**
After logging in, set up the office location for geolocation verification:
- Go to Admin Dashboard
- Click "Set Office Location" button
- Allow browser location access
- Confirm the detected location
- Set check-in radius (recommended: 100-500 meters)

#### 3. **Date Format Configuration**
Configure date display preferences:
- Access "Date Format Settings" in the admin dashboard
- Choose from:
  - **English**: Standard Gregorian calendar
  - **Nepali**: Bikram Sambat calendar
  - **Both**: Display both formats
- Set time format (12-hour or 24-hour)

### Daily Admin Operations

#### **Employee Management**
- **Add New Employees**:
  - Navigate to "Employee Management" section
  - Click "+ Add Employee"
  - Fill in employee details:
    - Full Name
    - Email Address
    - Initial Password
  - Employee receives login credentials to start using the system

- **View Employee List**:
  - See all employees in a table format
  - View employee details: Name, Email, Role, Date Added
  - Monitor employee status and activity

- **Remove Employees**:
  - Click delete button next to employee name
  - Confirm deletion in the dialog
  - All associated attendance records are also removed

#### **Attendance Monitoring**
- **Real-time Dashboard**:
  - Total Employees count
  - Today's Total Hours worked
  - Current Attendance Rate
  - Currently Checked-in Employees

- **Attendance Records**:
  - View comprehensive attendance table
  - Filter by employee and date range
  - Export reports for payroll and HR purposes
  - See check-in/out times, total hours, and status

#### **System Administration**
- **Office Location Management**:
  - Update office location if business moves
  - Adjust check-in radius for flexibility
  - Monitor location-based check-in attempts

- **Auto-Checkout Management**:
  - End-of-day cleanup for forgotten checkouts
  - Monitor auto-checkout events
  - Configure inactivity timeouts

### Admin Dashboard Features

```
üìä Dashboard Overview
‚îú‚îÄ‚îÄ üìà Statistics Cards
‚îÇ   ‚îú‚îÄ‚îÄ Total Employees
‚îÇ   ‚îú‚îÄ‚îÄ Today's Hours
‚îÇ   ‚îú‚îÄ‚îÄ Attendance Rate
‚îÇ   ‚îî‚îÄ‚îÄ Currently In Office
‚îú‚îÄ‚îÄ üè¢ Quick Actions
‚îÇ   ‚îú‚îÄ‚îÄ Set Office Location
‚îÇ   ‚îî‚îÄ‚îÄ Date Format Settings
‚îú‚îÄ‚îÄ üë• Employee Management
‚îÇ   ‚îú‚îÄ‚îÄ Add New Employee
‚îÇ   ‚îú‚îÄ‚îÄ View Employee List
‚îÇ   ‚îî‚îÄ‚îÄ Delete Employees
‚îî‚îÄ‚îÄ üìã Attendance Records
    ‚îú‚îÄ‚îÄ Filter by Date Range
    ‚îú‚îÄ‚îÄ Filter by Employee
    ‚îî‚îÄ‚îÄ Export Reports
```

---

## üë§ Employee Guide

### Getting Started

#### 1. **Receiving Access**
- Admin creates your account and provides:
  - Email address (your login username)
  - Temporary password
  - System URL

#### 2. **First Login**
- Navigate to `/auth/signin`
- Enter your email and password
- Update password if needed
- Access your employee dashboard

#### 3. **Initial Setup**
- Allow browser location access for check-in functionality
- Familiarize yourself with the dashboard layout
- Review your profile information

### Daily Operations

#### **Checking In**
1. **Arrive at Office**:
   - Ensure you're within office premises
   - Open the attendance system
   - Navigate to your dashboard

2. **Perform Check-in**:
   - Click the "Check In" button
   - System verifies your location
   - Confirmation message appears
   - Check-in time is recorded

3. **Check-in Requirements**:
   - ‚úÖ Must be within office radius
   - ‚úÖ Browser location access enabled
   - ‚úÖ Internet connection active
   - ‚úÖ Not already checked in for the day

#### **Checking Out**
1. **Manual Check-out**:
   - Click "Check Out" button before leaving
   - System calculates total working hours
   - Check-out time is recorded

2. **Automatic Check-out**:
   - System automatically checks you out if:
     - Browser window is closed
     - Extended inactivity (30+ minutes)
     - End of day cleanup (6 PM default)

#### **Monitoring Your Attendance**
- **Dashboard Overview**:
  - Current status (Checked In/Out)
  - Today's working hours
  - Check-in/out times
  - Live timer when checked in

- **Attendance History**:
  - View past attendance records
  - Filter by date range
  - See total hours per day
  - Monitor attendance patterns

### Employee Dashboard Features

```
üë§ Employee Dashboard
‚îú‚îÄ‚îÄ ‚è∞ Current Status
‚îÇ   ‚îú‚îÄ‚îÄ Check In/Out Buttons
‚îÇ   ‚îú‚îÄ‚îÄ Live Working Timer
‚îÇ   ‚îî‚îÄ‚îÄ Today's Hours
‚îú‚îÄ‚îÄ üìä Quick Stats
‚îÇ   ‚îú‚îÄ‚îÄ Today's Status
‚îÇ   ‚îú‚îÄ‚îÄ This Week's Hours
‚îÇ   ‚îî‚îÄ‚îÄ Monthly Summary
‚îú‚îÄ‚îÄ üìã Recent Attendance
‚îÇ   ‚îú‚îÄ‚îÄ Last 7 Days
‚îÇ   ‚îú‚îÄ‚îÄ Status Indicators
‚îÇ   ‚îî‚îÄ‚îÄ Hours Breakdown
‚îî‚îÄ‚îÄ ‚öôÔ∏è Settings
    ‚îú‚îÄ‚îÄ Date Format Preference
    ‚îú‚îÄ‚îÄ Time Format (12h/24h)
    ‚îî‚îÄ‚îÄ Profile Information
```

---

## üîÑ System Workflow

### Registration & Setup Flow
```mermaid
graph TD
    A[Admin Registers] --> B[Admin Logs In]
    B --> C[Set Office Location]
    C --> D[Configure Date Settings]
    D --> E[Add Employees]
    E --> F[Employees Receive Credentials]
    F --> G[System Ready for Use]
```

### Daily Attendance Flow
```mermaid
graph TD
    A[Employee Arrives at Office] --> B[Opens System]
    B --> C[Clicks Check In]
    C --> D{Location Verified?}
    D -->|Yes| E[Check In Successful]
    D -->|No| F[Location Error]
    E --> G[Work Throughout Day]
    G --> H[Ready to Leave]
    H --> I[Clicks Check Out]
    I --> J[Check Out Successful]
    
    G --> K{Browser Closed?}
    K -->|Yes| L[Auto Check Out]
    G --> M{Inactive 30+ min?}
    M -->|Yes| L
```

### Auto-Checkout Scenarios
```mermaid
graph TD
    A[Employee Checked In] --> B{Activity Monitoring}
    B --> C[Browser Close Detected]
    B --> D[30 Min Inactivity]
    B --> E[End of Day 6PM]
    C --> F[Auto Checkout]
    D --> F
    E --> F
    F --> G[Calculate Hours]
    G --> H[Update Database]
```

---

## ‚öôÔ∏è Configuration

### Office Location Settings
- **Radius**: 100-500 meters recommended
- **Coordinates**: Automatically detected or manually set
- **Accuracy**: GPS accuracy affects check-in success

### Date Format Options
- **English**: Aug 10, 2025 | 2:30 PM
- **Nepali**: ‡§∂‡•ç‡§∞‡§æ‡§µ‡§£ ‡•®‡•´, ‡•®‡•¶‡•Æ‡•® | ‡•ß‡•™:‡•©‡•¶
- **Both**: ‡§∂‡•ç‡§∞‡§æ‡§µ‡§£ ‡•®‡•´, ‡•®‡•¶‡•Æ‡•® (Aug 10, 2025)

### Auto-Checkout Settings
- **Inactivity Timeout**: 30 minutes (configurable)
- **End of Day**: 6:00 PM (configurable)
- **Browser Close**: Immediate (automatic)

---

## üîå API Reference

### Authentication Endpoints
- `POST /api/auth/register` - Admin registration
- `POST /api/auth/[...nextauth]` - NextAuth endpoints

### Attendance Endpoints
- `GET /api/attendance/status` - Get current status
- `POST /api/attendance/checkin` - Check in
- `POST /api/attendance/checkout` - Check out
- `POST /api/attendance/auto-checkout` - Auto checkout
- `GET /api/attendance` - Get attendance records

### Admin Endpoints
- `GET /api/admin/employees` - List employees
- `POST /api/admin/employees` - Add employee
- `DELETE /api/admin/employees` - Remove employee

### System Endpoints
- `GET /api/office-location` - Get office location
- `POST /api/office-location` - Set office location

---

## üîß Troubleshooting

### Common Issues

#### **Check-in Problems**
**Issue**: "Location verification failed"
- ‚úÖ Enable browser location access
- ‚úÖ Ensure GPS is active
- ‚úÖ Move closer to office location
- ‚úÖ Check internet connection

**Issue**: "Already checked in today"
- ‚úÖ Verify you haven't already checked in
- ‚úÖ Check dashboard status
- ‚úÖ Contact admin if data is incorrect

#### **Auto-Checkout Issues**
**Issue**: Not automatically checking out
- ‚úÖ Ensure browser supports beforeunload events
- ‚úÖ Check if ad blockers are interfering
- ‚úÖ Verify internet connection during exit

#### **Date Display Problems**
**Issue**: Wrong date showing
- ‚úÖ Check date format settings
- ‚úÖ Verify system timezone
- ‚úÖ Refresh browser cache

#### **Admin Access Issues**
**Issue**: Cannot access admin panel
- ‚úÖ Verify admin role in database
- ‚úÖ Check session authentication
- ‚úÖ Re-login if necessary

### Support & Maintenance

#### **Database Cleanup**
```bash
# End-of-day auto checkout
curl -X POST http://localhost:3000/api/attendance/cleanup \
  -H "Authorization: Bearer your-cron-api-key"
```

#### **System Health Checks**
- Monitor database connections
- Check API response times
- Verify geolocation services
- Review error logs

---

## üìà Best Practices

### For Admins
- üîí **Security**: Change default admin code in production
- üìç **Location**: Set appropriate office radius (not too strict/loose)
- ‚è∞ **Monitoring**: Review attendance daily for anomalies
- üîÑ **Backups**: Regular database backups
- üìä **Reports**: Generate weekly/monthly reports

### For Employees
- üì± **Device**: Use consistent device for attendance
- üåê **Browser**: Enable location services
- ‚è∞ **Timing**: Check in promptly upon arrival
- üîÑ **Logout**: Properly check out before leaving
- üìû **Issues**: Report problems immediately to admin

### For System Maintenance
- üîß **Updates**: Keep dependencies updated
- üìä **Monitoring**: Set up logging and monitoring
- üîê **Security**: Regular security audits
- üì¶ **Backups**: Automated daily backups
- üîÑ **Testing**: Test all features regularly

---

## üìö Additional Resources

- **Prisma Documentation**: [https://prisma.io/docs](https://prisma.io/docs)
- **NextAuth.js Guide**: [https://next-auth.js.org](https://next-auth.js.org)
- **Next.js Documentation**: [https://nextjs.org/docs](https://nextjs.org/docs)
- **Geolocation API**: [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API)

---

## ü§ù Support

For technical support or feature requests:
1. Check the troubleshooting section
2. Review system logs for errors
3. Contact system administrator
4. Report issues with detailed descriptions

---

*Built with ‚ù§Ô∏è using Next.js, Prisma, and modern web technologies*
